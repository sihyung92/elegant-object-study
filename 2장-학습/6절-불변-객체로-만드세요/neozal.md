# 2.6 불변 책체로 만드세요

- 모든 객체는 불변성을 가지도록 설계될 수 있다.
    - 언어적 차원에서 불가능한 경우도 있다. 지연된 로딩을 구현할 때 그 문제가 발생한다.
    ```java
    class Page {
        private final String uri;
        private String html;
        
        Page(String address) {
            this.uri = address;
            this.html = null;
        }     
        
        public String content() {
            if (this.html == null) {
                this.html = //get data from network.            
            }
            return this.html;
        } 
    }   
    ```
    - 예고르는 이런 기능을 언어적 차원에서 지원해줘야 한다고 생각한다.

## 불변성을 가지면 얻는 장점
- 식별자 가변성
    - 가변객체를 사용하면 객체의 상태에 변화에 따른 객체가 가리키는 식별자를 제대로 판단하지 못할 수 있다.
    - `five := new Money(5)` 를 했다가 `five.setMoney(10)` 을 하면 식별자 불일치가 발생한다.
    - 이러한 식별자 불일치는 심각한 버그로 이어질 수 있다.

- 실패 원자성
    - 객체가 완전히 견고하거나, 아니면 실패하거나 둘중 하나의 상태만 갖는다.
    - 불변 객체를 사용하면 별다른 노력 없이 원자성을 얻을 수 있기 때문.

- 시간적 결합
    - 코드의 순서에 따라 결과값이 달라지는 상황을 방지할 수 있다.
    - 가변객체의 경우 set의 위치에 따라 결과값이 달라질 수 있다.
    - 하지만 불변 객체를 사용하면 이러한 이이 발생하지 않는다.
    - 이는 초기화와 인스턴스화를 분리할 수 없는 특성으로 인해 발생한다.

- 부수효과 체거
    - 로직에서 객체의 상태를 변화시킴에 따라 발생하는 에러를 방지할 수 있다.
    - 시간적 결합과 비슷한 느낌.
  
- Null 참조 없애기
    - 값의 설정을 강제하기 때문에 null참조를 없앨 수 있다.
  
- 스레드 안전성
    - 불변클래스를 사용하면 상태가 변하지 않는다.
    - 따라서 여러 스레드에서 동시에 데이터에 접근하더라도 데이터 불일치가 발생하지 않는다.
    - 가변객체도 스레드 안정성을 보장할 수 있지만 구현이 어렵다.
  
- 더 작고 더 단순한 객체
    - 불변객체를 크게 만드는 일을 불가능하다. (생성자를 통한 초기화만 가능하기 때문)
    - 작은 객체는 유지보수성을 향상시킨다.
  

## 내 의견
이 장에 불만을 가진 당신. 반성하세요.